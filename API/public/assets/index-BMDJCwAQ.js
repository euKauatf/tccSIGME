import{r as s,j as e,I as S,J as A}from"./index-ClLVAdQ7.js";function F(){const[o,u]=s.useState([]),[j,m]=s.useState(!0),[p,f]=s.useState(null),[l,N]=s.useState(""),[r,b]=s.useState("todos"),[n,v]=s.useState(""),w=()=>{m(!0),S().then(a=>{u(a.data.data||a.data)}).catch(a=>{console.error("Erro ao carregar logs",a),f("Não foi possível carregar os logs de auditoria.")}).finally(()=>m(!1))};s.useEffect(()=>{w()},[]);const L=async()=>{if(window.confirm(`ATENÇÃO!

Tem certeza que deseja apagar TODO o histórico de auditoria? Esta ação não pode ser desfeita.`))try{await A(),alert("Log de auditoria limpo com sucesso!"),u([])}catch(a){alert("Ocorreu um erro ao tentar limpar os logs."),console.error(a)}},i=s.useMemo(()=>o.reduce((a,t)=>{const c=t.action.match(/na rodada (\d+)/);if(c){const d=parseInt(c[1],10);return d>a?d:a}return a},1),[o]),x={inscrito:["inscreveu-se"],contemplado:["foi contemplado"],"nao contemplado":["foi nao contemplado","foi cancelado"],presente:["presenca marcada"]},h=s.useMemo(()=>o.filter(a=>{var g;const t=!l||((g=a.user)==null?void 0:g.name.toLowerCase().includes(l.toLowerCase())),c=r==="todos"||x[r]&&x[r].some(C=>a.action.includes(C)),d=!n||a.action.match(new RegExp(`na rodada ${n}(?![0-9])`))!==null;return t&&c&&d}),[o,l,r,n]),y=a=>a.charAt(0).toUpperCase()+a.slice(1);return j?e.jsx("p",{className:"text-center p-8 text-xl",children:"Carregando logs de auditoria..."}):p?e.jsx("p",{className:"text-center p-8 text-xl text-red-500",children:p}):e.jsxs("div",{className:"main font-sans w-full p-4 flex flex-col items-center",children:[e.jsxs("div",{className:"w-full divp max-w-6xl flex justify-between items-center px-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-center text-emerald-800 py-3",children:"Log de Auditoria"}),e.jsx("button",{onClick:L,className:"btn btn-error btn-sm",children:"Limpar Logs"})]}),e.jsx("div",{className:"w-full max-w-6xl mt-6 bg-white divp rounded-lg shadow-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Pesquisar por nome"})}),e.jsx("input",{type:"text",placeholder:"Digite o nome do aluno...",className:"input input-bordered w-full",value:l,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filtrar por status"})}),e.jsxs("select",{className:"select select-bordered w-full",value:r,onChange:a=>b(a.target.value),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"inscrito",children:"Inscrito"}),e.jsx("option",{value:"contemplado",children:"Contemplado"}),e.jsx("option",{value:"nao contemplado",children:"Não Contemplado"}),e.jsx("option",{value:"presente",children:"Presente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filtrar por rodada"})}),e.jsx("input",{type:"number",placeholder:`Nº da rodada (1 a ${i})`,className:"input input-bordered w-full",value:n,min:"1",max:i,onChange:a=>{const t=a.target.value;(t===""||parseInt(t)>=1&&parseInt(t)<=i)&&v(t)}})]})]})}),e.jsx("div",{className:"w-full max-w-6xl mt-6",children:e.jsx("div",{className:"bg-white divp rounded-lg shadow-lg p-4 md:p-6",children:h.length>0?e.jsx("ul",{className:"space-y-3",children:h.map(a=>{var t;return e.jsxs("li",{className:"p-3 bg-gray-50 divp rounded-md border border-gray-200",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-emerald-600",children:((t=a.user)==null?void 0:t.name)||"Utilizador Apagado"}),e.jsxs("span",{className:"text-gray-700",children:[" ",y(a.action)," "]}),a.auditable&&e.jsxs("span",{className:"text-gray-700",children:["no evento ",e.jsx("span",{className:"font-bold",children:a.auditable.tema})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.created_at).toLocaleString("pt-BR")})]},a.id)})}):e.jsx("p",{className:"text-center text-gray-500 py-10",children:"Nenhum registo encontrado com os filtros aplicados."})})})]})}export{F as default};
